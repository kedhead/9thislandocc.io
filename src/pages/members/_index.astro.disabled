import MembersLayout from '../../layouts/MembersLayout.astro';
import SheetSection from '../../components/SheetSection.astro';

// 0. AUTH CHECK FIRST
if (!Astro.cookies.has('members_auth')) {
  return Astro.redirect('/members/login');
}

// 1. Config

// --- MAIN SCHEDULE SHEET ---
const SCHEDULE_SHEET_ID = '16RYQ7ssTJJ3K7sBMtfhHnftrDr8NU_ilUc1ES3vHOW8'; 
const SCHEDULE_SHEET_URL = "https://docs.google.com/spreadsheets/d/16RYQ7ssTJJ3K7sBMtfhHnftrDr8NU_ilUc1ES3vHOW8/edit";

// --- EQUIPMENT SHEET (Example Placeholder) ---
// Instructions: 
// 1. Create a new Google Sheet
// 2. Share it with the Service Account email
// 3. Paste the ID below
const EQUIPMENT_SHEET_ID = '16RYQ7ssTJJ3K7sBMtfhHnftrDr8NU_ilUc1ES3vHOW8'; // Replace with NEW ID
const EQUIPMENT_SHEET_URL = "https://docs.google.com/spreadsheets/d/16RYQ7ssTJJ3K7sBMtfhHnftrDr8NU_ilUc1ES3vHOW8/edit"; // Replace with NEW URL

const currentMonth = new Date().toLocaleString('en-US', { month: 'long' });

const isMock = !import.meta.env.GOOGLE_SERVICE_ACCOUNT_EMAIL;
---

<MembersLayout title="Dashboard">
  
  {isMock && (
    <div class="bg-yellow-50 border-b border-yellow-200 p-4 text-center text-yellow-800 text-sm">
      <strong>Demo Mode:</strong> Displaying example data. To see real data, configure Google Sheets credentials.
    </div>
  )}

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    
    <div class="mb-12 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
      <div>
        <h1 class="text-4xl font-bold text-gray-900 mb-2">Welcome, Ohana! ðŸ¤™</h1>
        <p class="text-gray-600">Here is the latest schedule and club updates.</p>
      </div>
      <a href={SCHEDULE_SHEET_URL} target="_blank" rel="noopener noreferrer" class="btn-lava px-6 py-3 rounded-lg font-bold flex items-center gap-2 shadow-md hover:shadow-lg transition">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
        Edit Schedule / Sign Up
      </a>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
      
      <!-- SCHEDULE CARD -->
      <SheetSection
        spreadsheetId={SCHEDULE_SHEET_ID}
        tabName={currentMonth} 
        title={`${currentMonth} Schedule`}
        color="bg-[var(--color-ocean-blue)]"
        viewLink={SCHEDULE_SHEET_URL}
        iconPath="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
      />

      <!-- SIGNUPS CARD (Using same sheet as schedule for now) -->
      <SheetSection
        spreadsheetId={SCHEDULE_SHEET_ID}
        tabName="Signups"
        title="Race Signups"
        color="bg-[var(--color-lava-orange)]"
        viewLink={SCHEDULE_SHEET_URL}
        iconPath="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"
      />

      <!-- EQUIPMENT LIST (Different Sheet) -->
      <SheetSection
        spreadsheetId={EQUIPMENT_SHEET_ID}
        tabName="Equipment"
        title="Equipment List"
        color="bg-purple-600"
        viewLink={EQUIPMENT_SHEET_URL}
        iconPath="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"
      />

      <!-- DOCUMENTS (example placeholder) -->
      <!-- You can add more SheetSections here easily -->

    </div>

    <!-- RESOURCES SECTION (Static for now, but could be dynamic) -->
    <div class="mt-12">
      <h2 class="text-2xl font-bold text-gray-900 mb-6 border-b pb-2">Club Documents</h2>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
        {['Safety Waiver', 'Code of Conduct', 'Paddling Technique Guide', 'Race Rules'].map(doc => (
          <a href="#" class="block p-6 bg-gray-50 rounded-lg hover:bg-gray-100 transition border border-gray-200 text-center group">
             <svg class="w-8 h-8 mx-auto text-gray-400 group-hover:text-[var(--color-ocean-blue)] mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
             <span class="font-medium text-gray-700">{doc}</span>
          </a>
        ))}
      </div>
    </div>

  </div>
</MembersLayout>
